<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EchoScan Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }
        .dashboard-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .controls {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .filter-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select, button {
            padding: 8px 12px;
            margin-right: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        button {
            background-color: #667eea;
            color: white;
            cursor: pointer;
            border: none;
        }
        button:hover {
            background-color: #5a67d8;
        }
        .results-table {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow-x: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        th {
            background-color: #f8f9fa;
            font-weight: bold;
        }
        .verdict-authentic { background-color: #d4edda; color: #155724; }
        .verdict-plausible { background-color: #fff3cd; color: #856404; }
        .verdict-hallucination { background-color: #f8d7da; color: #721c24; }
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 300px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -150px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
            line-height: 1.4;
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }
        .stat-label {
            font-size: 14px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üîç EchoScan Dashboard</h1>
        <p>Math-Anchored Symbolic Detection Analytics</p>
    </div>

    <div class="controls">
        <h3>üîß Analysis Controls</h3>
        <div class="filter-group">
            <label for="input-text">Input Text:</label>
            <input type="text" id="input-text" placeholder="Enter text to analyze..." style="width: 300px;">
            <button onclick="analyzeText()">üîç Analyze</button>
            <button onclick="analyzeBatch()">üìä Batch Analyze</button>
        </div>
        
        <div class="filter-group">
            <label for="verdict-filter">Filter by Verdict:</label>
            <select id="verdict-filter" onchange="filterResults()">
                <option value="all">All Verdicts</option>
                <option value="Authentic">Authentic</option>
                <option value="Plausible">Plausible</option>
                <option value="Hallucination">Hallucination</option>
            </select>
            
            <label for="min-echo-sense">Min EchoSense Score:</label>
            <input type="number" id="min-echo-sense" min="0" max="1" step="0.1" value="0" onchange="filterResults()">
            
            <button onclick="exportAudit()">üì• Export Audit</button>
            <button onclick="clearResults()">üóëÔ∏è Clear</button>
        </div>
    </div>

    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-number" id="total-analyses">0</div>
            <div class="stat-label">Total Analyses</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="authentic-count">0</div>
            <div class="stat-label">Authentic</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="plausible-count">0</div>
            <div class="stat-label">Plausible</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="hallucination-count">0</div>
            <div class="stat-label">Hallucination</div>
        </div>
    </div>

    <div class="dashboard-container">
        <div class="chart-container">
            <h3>üìà Delta S Drift Analysis</h3>
            <canvas id="driftChart" width="400" height="200"></canvas>
        </div>
        
        <div class="chart-container">
            <h3>üå≥ Ancestry Depth Distribution</h3>
            <canvas id="ancestryChart" width="400" height="200"></canvas>
        </div>
    </div>

    <div class="dashboard-container">
        <div class="chart-container">
            <h3>üß† EchoSense Score Timeline</h3>
            <canvas id="echoScoreChart" width="400" height="200"></canvas>
        </div>
        
        <div class="chart-container">
            <h3>üéØ Verdict Distribution</h3>
            <canvas id="verdictChart" width="400" height="200"></canvas>
        </div>
    </div>

    <div class="results-table">
        <h3>üìã Analysis Results</h3>
        <table id="results-table">
            <thead>
                <tr>
                    <th>Input</th>
                    <th>Verdict</th>
                    <th>Explanation</th>
                    <th>ŒîS Drift</th>
                    <th>EchoSense</th>
                    <th>Ancestry</th>
                    <th>Glyph ID</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="results-tbody">
                <!-- Results will be populated here -->
            </tbody>
        </table>
    </div>

    <script>
        let analysisResults = [];
        let charts = {};

        // Initialize charts
        function initializeCharts() {
            const ctxDrift = document.getElementById('driftChart').getContext('2d');
            charts.drift = new Chart(ctxDrift, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'ŒîS Drift',
                        data: [],
                        borderColor: 'rgb(102, 126, 234)',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 0.1
                        }
                    }
                }
            });

            const ctxAncestry = document.getElementById('ancestryChart').getContext('2d');
            charts.ancestry = new Chart(ctxAncestry, {
                type: 'bar',
                data: {
                    labels: ['1', '2', '3', '4', '5', '6+'],
                    datasets: [{
                        label: 'Count',
                        data: [0, 0, 0, 0, 0, 0],
                        backgroundColor: 'rgba(118, 75, 162, 0.6)',
                        borderColor: 'rgb(118, 75, 162)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            const ctxEchoScore = document.getElementById('echoScoreChart').getContext('2d');
            charts.echoScore = new Chart(ctxEchoScore, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'EchoSense Score',
                        data: [],
                        borderColor: 'rgb(255, 99, 132)',
                        backgroundColor: 'rgba(255, 99, 132, 0.1)',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 1
                        }
                    }
                }
            });

            const ctxVerdict = document.getElementById('verdictChart').getContext('2d');
            charts.verdict = new Chart(ctxVerdict, {
                type: 'doughnut',
                data: {
                    labels: ['Authentic', 'Plausible', 'Hallucination'],
                    datasets: [{
                        data: [0, 0, 0],
                        backgroundColor: [
                            'rgba(40, 167, 69, 0.8)',
                            'rgba(255, 193, 7, 0.8)',
                            'rgba(220, 53, 69, 0.8)'
                        ],
                        borderColor: [
                            'rgb(40, 167, 69)',
                            'rgb(255, 193, 7)',
                            'rgb(220, 53, 69)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true
                }
            });
        }

        // Analyze single text input
        async function analyzeText() {
            const inputText = document.getElementById('input-text').value.trim();
            if (!inputText) {
                alert('Please enter some text to analyze');
                return;
            }

            try {
                // Simulate API call to EchoVerifier
                const response = await fetch('/api/verify', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ text: inputText })
                });

                if (!response.ok) {
                    // Fallback to demo data if API not available
                    const mockResult = generateMockResult(inputText);
                    addResult(mockResult);
                    return;
                }

                const result = await response.json();
                addResult(result);
            } catch (error) {
                console.warn('API call failed, using mock data:', error);
                const mockResult = generateMockResult(inputText);
                addResult(mockResult);
            }
        }

        // Generate mock result for demonstration
        function generateMockResult(inputText) {
            const verdicts = ['Authentic', 'Plausible', 'Hallucination'];
            const verdict = verdicts[Math.floor(Math.random() * verdicts.length)];
            const deltaS = (Math.random() * 0.1).toFixed(6);
            const echoSense = (Math.random()).toFixed(6);
            const ancestry = Math.floor(Math.random() * 6) + 1;
            const glyphId = 'GHX-' + Math.random().toString(16).substr(2, 4).toUpperCase();
            
            return {
                input: inputText,
                verdict: verdict,
                explanation: `Verdict = ${verdict} (demo explanation for ${inputText.substring(0, 20)}...)`,
                delta_s: parseFloat(deltaS),
                echo_sense: parseFloat(echoSense),
                ancestry_depth: ancestry,
                glyph_id: glyphId,
                vault_permission: Math.random() > 0.5
            };
        }

        // Add result to dashboard
        function addResult(result) {
            result.timestamp = new Date().toISOString();
            analysisResults.push(result);
            updateTable();
            updateCharts();
            updateStats();
            document.getElementById('input-text').value = '';
        }

        // Update results table
        function updateTable() {
            const tbody = document.getElementById('results-tbody');
            tbody.innerHTML = '';

            const filteredResults = getFilteredResults();

            filteredResults.forEach((result, index) => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td class="tooltip">
                        ${result.input.substring(0, 30)}${result.input.length > 30 ? '...' : ''}
                        <span class="tooltiptext">${result.input}</span>
                    </td>
                    <td class="verdict-${result.verdict.toLowerCase()}">${result.verdict}</td>
                    <td class="tooltip">
                        ${result.explanation.substring(0, 40)}...
                        <span class="tooltiptext">${result.explanation}</span>
                    </td>
                    <td>${result.delta_s.toFixed(6)}</td>
                    <td>${result.echo_sense.toFixed(6)}</td>
                    <td>${result.ancestry_depth}</td>
                    <td>${result.glyph_id}</td>
                    <td>
                        <button onclick="viewDetails(${index})" style="font-size: 12px;">üëÅÔ∏è View</button>
                        <button onclick="deleteResult(${index})" style="font-size: 12px;">üóëÔ∏è</button>
                    </td>
                `;
            });
        }

        // Update all charts
        function updateCharts() {
            updateDriftChart();
            updateAncestryChart();
            updateEchoScoreChart();
            updateVerdictChart();
        }

        function updateDriftChart() {
            const recent = analysisResults.slice(-20);
            charts.drift.data.labels = recent.map((_, i) => i + 1);
            charts.drift.data.datasets[0].data = recent.map(r => r.delta_s);
            charts.drift.update();
        }

        function updateAncestryChart() {
            const counts = [0, 0, 0, 0, 0, 0];
            analysisResults.forEach(r => {
                const depth = Math.min(r.ancestry_depth - 1, 5);
                counts[depth]++;
            });
            charts.ancestry.data.datasets[0].data = counts;
            charts.ancestry.update();
        }

        function updateEchoScoreChart() {
            const recent = analysisResults.slice(-20);
            charts.echoScore.data.labels = recent.map((_, i) => i + 1);
            charts.echoScore.data.datasets[0].data = recent.map(r => r.echo_sense);
            charts.echoScore.update();
        }

        function updateVerdictChart() {
            const counts = { Authentic: 0, Plausible: 0, Hallucination: 0 };
            analysisResults.forEach(r => counts[r.verdict]++);
            charts.verdict.data.datasets[0].data = [counts.Authentic, counts.Plausible, counts.Hallucination];
            charts.verdict.update();
        }

        // Update statistics
        function updateStats() {
            document.getElementById('total-analyses').textContent = analysisResults.length;
            
            const counts = { Authentic: 0, Plausible: 0, Hallucination: 0 };
            analysisResults.forEach(r => counts[r.verdict]++);
            
            document.getElementById('authentic-count').textContent = counts.Authentic;
            document.getElementById('plausible-count').textContent = counts.Plausible;
            document.getElementById('hallucination-count').textContent = counts.Hallucination;
        }

        // Filter results
        function getFilteredResults() {
            const verdictFilter = document.getElementById('verdict-filter').value;
            const minEchoSense = parseFloat(document.getElementById('min-echo-sense').value);

            return analysisResults.filter(result => {
                const verdictMatch = verdictFilter === 'all' || result.verdict === verdictFilter;
                const echoSenseMatch = result.echo_sense >= minEchoSense;
                return verdictMatch && echoSenseMatch;
            });
        }

        function filterResults() {
            updateTable();
        }

        // Batch analysis
        async function analyzeBatch() {
            const sampleTexts = [
                "Hello world, this is a test",
                "AI generated synthetic content with patterns",
                "Natural human written text with emotion",
                "Code snippet: function test() { return true; }",
                "Mixed content 123 with numbers and symbols!",
                "Unicode test: ‰Ω†Â•Ω‰∏ñÁïå üåç"
            ];

            for (const text of sampleTexts) {
                const mockResult = generateMockResult(text);
                addResult(mockResult);
                await new Promise(resolve => setTimeout(resolve, 200)); // Simulate processing delay
            }
        }

        // Export audit data
        function exportAudit() {
            const filteredResults = getFilteredResults();
            const auditData = {
                export_timestamp: new Date().toISOString(),
                total_analyses: analysisResults.length,
                filtered_analyses: filteredResults.length,
                results: filteredResults.map(result => ({
                    ...result,
                    confidence_band: result.echo_sense > 0.8 ? 'High' : result.echo_sense > 0.5 ? 'Medium' : 'Low',
                    trust_chain: `SBSH->ŒîS->Fold->Glyph->Ancestry->EchoSense`
                }))
            };

            const dataStr = JSON.stringify(auditData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `echoscan_audit_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            URL.revokeObjectURL(url);
        }

        // View result details
        function viewDetails(index) {
            const result = analysisResults[index];
            const details = JSON.stringify(result, null, 2);
            
            const popup = window.open('', 'ResultDetails', 'width=600,height=400,scrollbars=yes');
            popup.document.write(`
                <html>
                    <head><title>Analysis Details</title></head>
                    <body style="font-family: monospace; padding: 20px;">
                        <h2>üîç Analysis Details</h2>
                        <pre>${details}</pre>
                        <button onclick="window.close()">Close</button>
                    </body>
                </html>
            `);
        }

        // Delete result
        function deleteResult(index) {
            if (confirm('Are you sure you want to delete this result?')) {
                analysisResults.splice(index, 1);
                updateTable();
                updateCharts();
                updateStats();
            }
        }

        // Clear all results
        function clearResults() {
            if (confirm('Are you sure you want to clear all results?')) {
                analysisResults = [];
                updateTable();
                updateCharts();
                updateStats();
            }
        }

        // Initialize dashboard on load
        document.addEventListener('DOMContentLoaded', function() {
            initializeCharts();
            
            // Add some sample data for demonstration
            setTimeout(() => {
                analyzeBatch();
            }, 1000);
        });
    </script>
</body>
</html>